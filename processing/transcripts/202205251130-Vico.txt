So, this is the title of my talk: Transpose Method for Quasi-Newton Optimization Problems in Acoustic and Electromagnetism. So, this talk is actually about a very simple topic. This is a project that I'm starting. There is a math part and there is another engineering part that will take longer, but the math part, most of that is essentially over. Most of that is essentially over, and it's relatively simple. So that's what I wanted to talk about here. Sorry, how do I move? Okay, so this is the outline of the talk. First, I will talk about the motivation and then formulation for acoustics, numerical examples for acoustics, then formulation for electromagnetism, and then some numerical examples for electromagnetism, and then some future lines. So in the In the recent years, metasurfaces and metamaterials has become a very hot topic in different areas like antennas and propagation and also photonics. So there is a huge number of papers and talks and work related to that. And here I just point to a particular well-known paper. Paper where they build flat antennas based on these things that they call, everybody calls meta-surfaces. So the idea here is the following. You want to create a material with some strange properties, interesting properties for the application based on certain microscopic, so to say, microscopic. So to say, microscopic elements or small elements that are located in following certain patterns in the sense of variable density or changing orientation. And with that, you try to create a material that, from the macroscopic viewpoint, has certain interesting properties. So, for example, in this case, these guys built They these guys built a flat antenna with high directivity and two beams, one at frequency F1, another one at frequency F2. That was very interesting for the application. And there are also many works following the similar ideas in higher frequencies in photonics. So the idea is again the same. You try to create some material with some. Material with some property based on the repetition with small changes of small elements. And the scheme that people follow in this type of papers is always the same. They have something like an in-between, an intermediate notion of how to explain. There is like an intermediate notion that they create in the following sense. They try to engineer some kind of boundary condition, like impedance boundary condition or variable epsilon that is engineered to have certain macroscopic properties. And then they try to create this boundary condition using this microscopic structure. Microscopic structure. So, this intermediate notion is created to handle the relationship between the macroscopic and the microscopic worlds and also in a way that they can understand what they are doing. So, this is, you know, if you search the world, there are many, many papers and work related to metamaterials, meta surfaces, and it's related to it's related to that idea, right? So what we were trying to are trying to do here in this project that we're starting now is to try to remove this intermediate level in the sense that why don't we think of a material that has some properties that are function of the insertions that we put. The insertions that we put inside the material. So let's say there is a material, and then inside it, you put some insertions made of some other material, and these insertions are the same. Maybe they are rotated, but they are located in different positions in space and with different Euler angles. And you just remove this intermediate notion of equivalent epsilon or equivalent. Epsilon or equivalent boundary condition or equivalent impedance normally condition, you just consider the material as a material described by many, many variables, many, many degrees of freedom, like the position of this insertion or the orientation and the orientation. And then you try to design, so to say, a goal-oriented material. So you design these variables to achieve certain goal, period, without those intermediate. Without those intermediate notions of equivalent epsilon or things like this. So that was the idea. So we were interested in because we work in electrical engineering school, we were interested in electromagnetic applications, but we made the acoustic code first to warm up. So this is a very simple situation for Situation for this problem where you have, I mean, here you can just forget about this box. This box is supposed to be a material with epsilon equal to the ambient epsilon that is just there to hold the spheres in their location, right? So it's essentially free space with perfectly heavy conducting spheres, and you just have to compute the scattered field produced by a known incoming field. So, best case is. Incoming field, so best case scenario, right? So, how do we solve it? It's very well known. You just write, I believe, there's a minus sign here instead of plus. You write the standard interal equation, you write the unknown sources on each sphere written as an expansion of spherical harmonics, and then the key. And then the key ingredient is this operator here that maps the outgoing. I mean, you can write the scatter field as a sum of outgoing H, as an outgoing expansion centered on each sphere. And the outgoing fields produced by any sphere can be read. Sphere can be written as J expansion centered on any sphere. So this map that gives you incoming J expansions from outgoing age expansions can be computed efficiently using the FMM and this map that gives you the incoming coefficients from the outgoing coefficients. For that, I used a code made by That I used a code made by I think by Mike O'Neill. So, thanks for him. And once you have that, so everything is very simple. Here, to clarify myself, I decided to go galerking. In this scenario, it's almost irrelevant because everything is trivial. So, this sigma and B with this line in the top is just In the top is just a big vector of numbers. It's just a collection of all the coefficients in every sphere for the unknown and for the right-hand side. And here you have the expressions for the right-hand side with the incoming field. And then the operator, the matrix, is given by this expression that you can compute very fast with the FMM algorithm using this T operator together with some. Operator together with some trivial diagonal operators previously prior and post the T operator. So this multiplying by this matrix is very, very fast. So once you have that, you are done with the solve, but you don't want to solve. You want to optimize certain goal function. And you can put an arbitrary goal function, but we decided to start with the simplest possible goal function that you can imagine. So you want to That you can imagine, so you want to optimize the total field in a particular target point, which is given and fixed, right? So, it's like optimizing the focal point. For example, you are designing a lens that is supposed to work focusing the incoming field from a particular direction, and you want to optimize the field, maximize the field, the magnitude of the field in a particular point. Particular point. So we want to optimize it using a quasi-Newton algorithm because we believe it will be much faster than algorithms that don't use gradient. And in order to do that, for the sake of notation, we rearrange all the variables to optimize inside a big array with all the coordinates of all the. With all the coordinates of all the spheres inside the B array that we call lambda. And by doing that, we just realized that the goal function is a function of those parameters and also the densities on each sphere, the induced densities on each sphere. And to clarify the chain rule, we just repeat this variable and then we just declare that the goal function is a function of. The goal function is a function of the location of the spheres and the induced source on each sphere, and both things are a function of the location of the spheres, right? So we just compute the chain rule to compute the gradient. This is the gradient together with the evaluation of the gold function will be fed into a quasi-Newton algorithm like BFGS. And that's the idea. So here are the only tricky. So, here the only tricky term is this guy here. The other ones are trivial, as I will mention later. This tricky term, in order to do that, to compute that, you have to take the derivative of the integral equation that you have just solved. You obtain these terms here, and you realize that the guy that you need, sorry, the guy that you need is just this guy, right? So, you put this guy here and the rest here. Guy here and the rest here. Then you realize that to compute this guy, you need to invert a linear system with a right-hand side that depends on the variable that you want to optimize. So you have to, in principle, to solve as many linear systems as variables you want to optimize to compute the gradient at a particular point. So if you feed that into the final expression in the chain rule, Final expression in the chain rule, you have this long expression for the gradient of the gold function, and here's where the transpose trick, as I call it, comes, what people call it the transpose method. So this scalar function can be written as the transpose of this scalar function, and then you realize that this guy goes here, and this guy, which is not dependent on the variable that you want to optimize, I mean, it's just a constant vector. I mean, it's just a constant vector, it goes in the other way. Then you realize that instead of solving n linear systems, n for every variable that you want to optimize, and then average them against this constant vector, you just need to solve one linear system, one big linear system, with a transpose matrix, and then do some post-process, which is a lot faster. Uh, faster. Um, well, the rest of the terms are very simple. For example, if you take the derivative of the right-hand side with respect to the location of certain sphere, you can just move the derivative with respect to the location of the integration domain inside to the derivative of the incoming field and put a minus sign here. Then, another simple detail, you will also need the derivative of the Derivative of the field of the potential with respect to the location of a sphere. And that can be used, that can be obtained simply by the H expansion and then taking derivatives. I mean, these expressions of the partial derivative with respect of x, y, and z of the h expansion are very simple. And some other details. This term here is just a linear, I mean, this is just a linear function, so the partial derivative is literally these coefficients here, very simple. And then the last piece that you need is the derivative of the set with respect to the set matrix with respect to the location of a particular sphere in X, Y, and Z. So if you remember this term here in the expression appears Int expression appears multiplied by a column vector here and by a row vector here. And this is this is just what happens here, right? By a column vector and then this by a row vector here. So you need to do that for every sphere. So here these stars are elements that are not zero. So in other words, when you move a little bit a sphere, The derivative of the matrix is not zero only for elements that correspond to any sphere to that sphere that is moving and to that sphere that is moving to other any other spheres. So any other pair of spheres that are fixed, the derivative is zero, obviously. So you need to compute these elements and this for every sphere in every direction, right? So in the end, if you do that by brute force, If you do that by brute force, you will have an n-square algorithm. So, the idea is to compute well this operator separate as two operators, one with all the rows and another one with all the columns. And then compute all the rows using an FMM call and all the columns using an FMM call. And then some post-process to compute the derivatives. So these are the details, right? Essentially, you just The details, right? Essentially, you just compute, I just said, you compute the, you invoke the t operator. And in order to compute this vector multiplied by all the rows that will appear when you move all the spheres in all directions, you compute that by computing the T operator. And then once you have the incoming J expansion on a particular sphere. J expansion on a particular sphere, you just compute the derivative of the field itself. And then this is for all the rows, and for all the columns, you do the exact same thing, thinking in the transpose vector here, the exact same thing, but for the dual integral equation, right? And then finally, what you have is that for every evaluation of the goal function and of the derivative. function and of the derivative of the gradient of the gold function, you only need to solve two big linear systems, one with the one with the matrix, another with the transpose of the matrix, and then to do two extra FMM calls. And that's it. With that, you have the goal function evaluated and the gradient of the goal function evaluated. And this is just a very simple example where there is a plane wave or inodmaric. There is a plane wave in all my examples, the plane waves come from the bottom to the top. And I just want to optimize the total field in a particular focal point here. Here, in addition, I restrict the location of the spheres to a particular point, to a particular plane, set equals zero. And that's the solution that I get. Here, I don't use this additional constraint so the spheres can move. Constraint so the spheres can move freely in free space, and I get a better solution, obviously. I mean, if all the spheres are in a particular plane, then there will be some reflections necessarily, as you can see here in the negative part of the space, negative. While if you allow different spheres in different locations in S, then the the there's more adaptivity and there's less total reflection. And there's less total reflection, so to say. And here, another example with many, many more spheres. So this is the warm-up for acoustics. Sorry, what I did. Oh, Jesus. Okay. So now I just need to repeat the exercise for Maxwell. Maxwell is the exact same thing. Maxwell. Maxwell is the exact same thing. I start with spheres, perfectly electric conducting spheres, and I saw the scattering problem. Here, I'm going to refer to a paper made by Kim Butas and Leslie Gringer, Fast Multiparticle Scattering. And I'm actually using that code. And it's very, very fast and very convenient for that problem. So it's the same problem. So it's the same problem. I have n spheres, perfectly conducting spheres, and I want to compute the scatter field produced by a known incoming field. And here the scatter field can be again written as an outgoing expansion of vector spectral harmonics. And there is a map that gives you the incoming expansion produced by all these guys with center in any sphere. With center in any sphere, this map can be computed by efficiently by using the FMM. And essentially, the only ingredient that we need if we want to use these coefficients as unknowns is the reflection matrix. This reflection matrix gives you the outgoing H expansion produced by an arbitrary incoming J mode. J mode. This is the reflection matrix. I just use the reflection matrix of a perfectly conducting sphere, but this can be changed by any other thing that is previously pre-computed. We have tools to do that. So the plan is to generalize that, but first to develop all the ingredients. So once you have the reflection matrix, and that in this case is the reflection matrix for perfectly double. Matrix for perfectly conducting spheres, the integral equation that you have to solve is this one, where this guy is just a huge vector collecting all the coefficients of the outgoing expansion, A and B. And then this is the identity minus R times T times the same vector unknown equals to the right-hand side, which is the reflection acting on the coefficients of the incoming J expansion of the incoming field. Coming field on the center on each sphere. Well, this is a second time integral equation. You can solve it. And once you use the correct notation, you realize that everything is completely analog to the scatter problem. So you have to do the exact same things in the exact same order. Take the derivative. You realize that this guy is the guy that is more tricky. You put this this way. Tricky, you put this this way and you use the usual transpose trick. For example, the derivative of the right-hand side, you use the same trick. You move the derivative with respect to the location of the sphere, which is the integration domain, inside and put a minus sign here. Well, here is something to notice when you want to compute the derivative of the field, of the scatter field. Of the field of the scatter field with respect to the location of a sphere for a particular known coefficient for a particular known set of coefficients, you don't want to take the derivative of this vector spherical harmonics because it's too complicated. And here I followed a suggestion made by Manas and I think Leslie also, which is the following, this Maxwellian. This Maxwellian field can be written as three scalar Hemhole fields, and this projection maps that gives you A1, A2, and A3 for the three Cartesian components from A and B, from the Devy expansion, can be pre-computed and can be applied numerically very fast because it's only local work on each sphere. And then, as you know how to derive. And then, as you know how to derivate Hemholph fields, as I explained in the SCAR case, everything is trivial and very fast. So, in essence, all you need is a good FMM algorithm to compute the T operator and then do local work pre-computed and very fast. That only requires coefficients of particular spheres separately. And moreover, Separately. And moreover, those multiplications are sparse, so it's extremely fast. That was the only detail here. And this is just an example of Maxwellian, a Maxwell example. There's also an incoming field coming from the bottom to the top. The polarization is in the x-direction, and this is the focal point. And you get this final distribution of spheres. This final distribution of spheres with this final total field. This is the final distribution of spheres. And this is the initial distribution of spheres. That, well, that was a toy example with an extremely small number of spheres, everything, just to be sure that the code is working, which is the current state of the project. And just some numbers, this took two minutes and a half to optimize and 24 BFGS iterations. And that's it. I mean, the future lines are first to generalize to arbitrary insertion. So, this is simply replacing the reflection matrix by an arbitrary matrix that can be obtained using standard Maxwell code that we have for electric conductors, for homogeneous dielectrics, or for. Homogeneous dielectrics or for inhomogeneous dielectrics. Also, to optimize the orientation of the Euler angles, I think for that we will need nice recurrence relations of the derivative of the rotations of the spherical harmonics, probably, and maybe also to optimize the size of the insertion, although I'm not completely sure if that. Although I'm not completely sure if that will be useful or easy to do. And finally, well, start the engineering project, which is explore the search space, explore the heuristics, hire a couple of PhD students in engineering. Also, study stability of the design. I mean, once you have the final distribution of Final distribution of insertions, you want to move a little bit and see if the solution is still there or has disappeared, because you will have some tolerances when you prototype or you fabricate this. And then go ahead, prototyping, measuring, and we have a particular applications in mind related to 5G and 6G communications, and maybe also some. Maybe also some RAM, which is radiation absorbing material applications. I mean, you may have a material with high absorption, but it doesn't mean that there's no reflection. For example, you have the sea and the water of the sea has a high losses, but it doesn't mean that a wave coming from the sun doesn't reflect. So the small part that goes inside gets attenuated. Inside and gets attenuated, but there is a big part that gets reflected. So, designing engineering and radiating absorbing materials is a hard problem and we believe that we might have something to say about that. Well, I find this line of research interesting for several reasons. The main reason is not that I believe that it's going to be a complete success. That it's going to be a complete success. We will see what the optimizers say. But at least I think, based on those simple examples, we have ruled out the possibility of a complete failure, which is something. And also because that another reason is that it might be a good way to sell high-order algorithms because there is a number of people that. There is a number of people that is reluctant to appreciate digits beyond two. And well, if they have the need of computing the derivative, well, they will have a problem. And for that, you know, for the pre-computation of the reflection matrix for a particular arbitrary insertion, something like this, you may need a high-order code to do the calculations correctly and be able to. And be able to obtain the gradient, a few digits at least of the gradient, and then run the appropriate quasi-Newton algorithm. And also, we are writing a number of proposals and people in the board seem to like this kind of line of research. We'll see if we are all wrong or there's something interesting out there. And that concludes my talk. That concludes my talk. Thank you very much. Thank you very much, Felipe. Do you have question? Can I have a question? Yes. So now you have incident wave as a primary. So if you have different incident waves, different type of incident waves. Type of intercenter waves, does your optimized solution stay same? Also, only your solution has a frequency dependence. Say it again. Does the solution depend on the wavelength of incident waves? Well, I mean, this you can. I mean, you can build your own goal function that can be a mixture of things that happens at different frequencies. And that would require to solve the problem at different frequencies. I don't know if that's what you mean. I mean, so if you have an optimalized solution, like focus, focal point, so if you change a different plane wave with a different frequency, Plane wave with different frequency, do the focal point will be moving or will stay at the location you attend? Well, obviously, if you move enough, the frequency it will change. Now, the question is if there's an interesting goal function that will produce the desired bandwidth. I mean, it's known that in all sorry. I mean, it's known that in all these papers that talk about metamaterials, they have, for example, these things that they like a lot, these flat antennas, they have a directivity similar to a parabolic antenna, but they have much smaller, much narrower bandwidth for obvious reasons. So this is a known issue and Issue and the thing that they are tied to this intermediate notion, we might be able to optimize whatever, for example, the focal point at a sequence of frequencies. But yes, those are very interesting questions that we will find out in the future. Thanks. So, there is one question for Unar first. Yes, I was just curious, is there a really Yes, I was just curious: is there a risk of getting stuck in local minima here? If you restart, you find different ones? Are they differently optimal? How do you handle that? Yes, of course. I mean, we are in the worst possible regime. This is a high-dimensional, highly non-complex problem. That's why I say that here the math finish and it starts the engineering project because we will need to find out good heuristics for good. Find out good heuristics for good starting points, for good search. Yes, I mean, the answer is yes, and we'll see what comes out from that. Thanks. And there is a question from Alex, I think. We're going to go with Jason first. Yeah, maybe this question is related to gunners, and maybe it won't be so precise. Gunners and maybe won't be so precise, but you get these kind of, I don't know, very non-intuitive arrangements of your insertions. And, you know, are there sort of more intuitive arrangements that do almost as well? Or do you really need this optimization to maybe not that picture, but there was a point to that picture because here Here, there was a couple of constraints. One is that all the spheres will have to be at set equals zero, and the other one is that you cannot go beyond certain box. I didn't mention. And then the algorithm found a well-known solution, which is two rings separated lambda over two, which is known in the literature as a metallic lens in some sense. So, my expectation is that if you put enough constraints and you That if you put enough constraints and you guide the optimization, you will find known solutions, but you might also be able to find non-known solutions. Maybe after finding them, you might be able to interpret, or maybe it's just way too complicated. And here, the only issue is that do we have a systematic manufacturing technique or not? Because, I mean, it might be complicated for a human high, but if there's a On the human high, but if there's a systematic way of building this, it won't be a problem, right? That's it. Okay, thanks. All right, Alex. So, yeah, maybe we'll continue discussions tomorrow after the morning session. So, I'll hand it back to Stephanie. I'll hand it back to Stephanie. Okay, okay, so thank you very much, Felipe. And let's move to Timo.